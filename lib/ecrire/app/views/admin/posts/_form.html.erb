<%= form_for post,
  builder: Admin::PostBuilder,
  html: {class: %w(post editor), id: "postEditor"} do |f| %>

  <%= hidden_field_tag :context, :content %>

  <nav class="post">
    <ol class="menu">
      <li class='active' target='content'>Content</li>
      <li target='stylesheet'>Stylesheet</li>
      <li target='javascript'>Javascript</li>
      <li class="actions">
        <%= f.action %>
      </li>
    </ol>

    <% unless Admin::Image.new.s3.connected? %>
      <div class="missing configuration">
        <h3>Configure</h3>
        <p>You cannot use images in your posts until you add a S3 bucket.</p>
        <%= link_to "Configure S3", admin_configurations_images_path, class: %w(button) %>
      </div>
    <% end %>

    <% if post.draft? %>
      <p class="status" data-saving="Saving your post...">Drafts are saved automatically</p>
    <% else %>
      <p class="status warning" data-saving="Saving your post...">Published post needs to be <strong>manually</strong> saved</p>
    <% end %>

  </nav>
  <%= f.editor %>

<% end %>

<aside class="preview">

  <header>
    <%= content_tag :p, post_path(post.becomes(::Post), only_path: false), class: %w(url) %>
    <%= form_for post,
      html: {class: %w(post title settings)} do |f| %>
      <%= hidden_field_tag :context, :title %>

      <%= f.text_field :title, class: %w(title), autocomplete: :off %>
    <% end %>

    <section class="labels">
      <%= form_for [post, Admin::Label.new],
        html: {class: %w(labels new)},
        remote: true,
        url: admin_post_properties_path(post.id) do |f| %>
        <fieldset>
          <%= f.text_field :name, placeholder: 'Create a new label' %>
          <%= f.button 'â†µ' %>
        </fieldset>
      <% end %>

      <%= decorate @labels, :button, post: post, properties: post.properties.labels.includes(:data) %>
    </section>
  </header>

  <%= render 'admin/images/form', post: post, image: post.images.new %>
  <%= content_tag :style, post.stylesheet.html_safe, scoped: :scoped, class: %w(stylesheet) %>
  <%= content_tag :script, post.javascript.html_safe, type: 'text/javascript', class: %w(javascript) %>
  <%= content_tag :article, post.content.html_safe, class: %w(content) %>
</aside>

<nav class="admin options">
  <%= editor_back_button(post) %>
</nav>

